<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BiciCoruña - Dynamics</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --bg:#0F172A; --glass:rgba(15,23,42,0.9); --text:#F8FAFC; }
        body { margin:0; font-family:'Inter', sans-serif; background:var(--bg); color:var(--text); overflow:hidden; }
        #map { height:100vh; filter:saturate(1.2) brightness(0.9); }
        .panel { position:absolute; z-index:1000; background:var(--glass); padding:15px; border-radius:12px; border:1px solid rgba(255,255,255,0.1); backdrop-filter:blur(10px); }
        
        .legend-row { display:flex; align-items:center; gap:8px; margin-bottom:6px; font-size:12px; color:#cbd5e1; }
        .dot { width:8px; height:8px; border-radius:50%; }
        .halo { width:10px; height:10px; border-radius:50%; border:2px solid; background:transparent; }
        
        /* Dynamic Cluster Colors */
        .c0 { border-color: #06B6D4; color: #06B6D4; }
.c1 { border-color: #D946EF; color: #D946EF; }
.c2 { border-color: #FACC15; color: #FACC15; }
.c3 { border-color: #8B5CF6; color: #8B5CF6; }

        
        /* Occupancy */
        .occ-low { background: #EF4444; }
        .occ-med { background: #F59E0B; }
        .occ-high { background: #10B981; }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="panel" style="top:20px; left:20px;">
        <h1 style="margin:0; font-size:18px;">Dinámicas Urbanas</h1>
        <p style="margin:4px 0 0; font-size:12px; opacity:0.7;">K-MEANS (K=4) + FLUJOS</p>
    </div>

    <div class="panel" style="bottom:30px; right:20px;">
        <b style="font-size:12px; display:block; margin-bottom:8px; color:#94A3B8;">TIPO DE ESTACIÓN (HALO)</b>
        <div class="legend-row"><span class="halo c0"></span> Cluster 1</div>
<div class="legend-row"><span class="halo c1"></span> Cluster 2</div>
<div class="legend-row"><span class="halo c2"></span> Cluster 3</div>
<div class="legend-row"><span class="halo c3"></span> Cluster 4</div>

        
        <b style="font-size:12px; display:block; margin:16px 0 8px; color:#94A3B8;">OCUPACIÓN (RELLENO)</b>
        <div class="legend-row"><span class="dot occ-low"></span> < 30%</div>
        <div class="legend-row"><span class="dot occ-med"></span> 30-60%</div>
        <div class="legend-row"><span class="dot occ-high"></span> > 60%</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const stations = [{"name": " Pablo Picasso", "lat": 43.346126, "lon": -8.410817, "capacity": 19, "bikes": 9.28862590401052, "occupancy": 0.488875047579501, "cluster": 1}, {"name": "Adormideras", "lat": 43.38337475533955, "lon": -8.39564819014358, "capacity": 19, "bikes": 9.2603550295858, "occupancy": 0.48738710682030517, "cluster": 3}, {"name": "Agra do Orz\u00e0n", "lat": 43.36264, "lon": -8.4232, "capacity": 15, "bikes": 4.219223173140223, "occupancy": 0.2812815448760149, "cluster": 2}, {"name": "Agrela", "lat": 43.35436551376532, "lon": -8.422193301049806, "capacity": 21, "bikes": 8.738330046022353, "occupancy": 0.41611095457249303, "cluster": 0}, {"name": "Agrela II", "lat": 43.348314, "lon": -8.420575, "capacity": 19, "bikes": 5.690789473684211, "occupancy": 0.2995152354570637, "cluster": 2}, {"name": "Agrela III", "lat": 43.3519, "lon": -8.4319, "capacity": 19, "bikes": 8.39342105263158, "occupancy": 0.44175900277008306, "cluster": 1}, {"name": "Aparcamiento Matogrande", "lat": 43.34080343343825, "lon": -8.404671581745156, "capacity": 15, "bikes": 5.3800131492439185, "occupancy": 0.3586675432829279, "cluster": 2}, {"name": "Aquarium", "lat": 43.3812011, "lon": -8.4099486, "capacity": 15, "bikes": 6.803418803418803, "occupancy": 0.45356125356125354, "cluster": 3}, {"name": "Avenida de Arteixo", "lat": 43.360755, "lon": -8.410942, "capacity": 15, "bikes": 6.654605263157895, "occupancy": 0.443640350877193, "cluster": 1}, {"name": "Barrio de las Flores", "lat": 43.346372, "lon": -8.403369, "capacity": 23, "bikes": 12.239973701512163, "occupancy": 0.5321727696309636, "cluster": 1}, {"name": "Barrio de las Flores II", "lat": 43.344147, "lon": -8.401101, "capacity": 19, "bikes": 5.675, "occupancy": 0.2986842105263158, "cluster": 2}, {"name": "Birloque", "lat": 43.340498, "lon": -8.41651, "capacity": 19, "bikes": 4.5131578947368425, "occupancy": 0.23753462603878114, "cluster": 2}, {"name": "Campo de La Le\u00f1a (Plaza De Espa\u00f1a)", "lat": 43.3725483, "lon": -8.3956685, "capacity": 15, "bikes": 6.403024326101249, "occupancy": 0.42686828840674995, "cluster": 3}, {"name": "Campo de Marte", "lat": 43.375696, "lon": -8.398101, "capacity": 15, "bikes": 6.926364234056542, "occupancy": 0.4617576156037695, "cluster": 3}, {"name": "Cantons - Alameda", "lat": 43.366957, "lon": -8.40429, "capacity": 19, "bikes": 7.261184210526316, "occupancy": 0.3821675900277008, "cluster": 0}, {"name": "Casa de Sol", "lat": 43.372345, "lon": -8.4028996, "capacity": 16, "bikes": 7.391847468770545, "occupancy": 0.4619904667981591, "cluster": 0}, {"name": "Casa del Agua", "lat": 43.3689494, "lon": -8.4197601, "capacity": 16, "bikes": 6.550657894736842, "occupancy": 0.40941611842105263, "cluster": 0}, {"name": "Cd Castrill\u00f3n", "lat": 43.349334477951, "lon": -8.398615367597959, "capacity": 15, "bikes": 6.338593030900723, "occupancy": 0.4225728687267149, "cluster": 3}, {"name": "Centro C\u00edvico Monelos", "lat": 43.3493537, "lon": -8.4049558, "capacity": 15, "bikes": 6.442472057856674, "occupancy": 0.4294981371904449, "cluster": 1}, {"name": "Centro deportivo Elvi\u00f1a", "lat": 43.34181585290314, "lon": -8.414121004104622, "capacity": 19, "bikes": 7.366447368421053, "occupancy": 0.38770775623268694, "cluster": 0}, {"name": "Chuac", "lat": 43.345885, "lon": -8.390163, "capacity": 19, "bikes": 9.216447368421052, "occupancy": 0.48507617728531854, "cluster": 0}, {"name": "Ciudad Escolar", "lat": 43.37110620280361, "lon": -8.421887669697579, "capacity": 19, "bikes": 9.080210387902696, "occupancy": 0.4779058098896155, "cluster": 3}, {"name": "Concordia", "lat": 43.351551, "lon": -8.394042, "capacity": 19, "bikes": 8.913157894736843, "occupancy": 0.4691135734072022, "cluster": 3}, {"name": "Cuatro Caminos", "lat": 43.35662, "lon": -8.40617, "capacity": 23, "bikes": 8.51907894736842, "occupancy": 0.3703947368421053, "cluster": 2}, {"name": "Estaci\u00f3n Autobuses", "lat": 43.353622, "lon": -8.4059565, "capacity": 15, "bikes": 7.199211045364891, "occupancy": 0.4799474030243261, "cluster": 1}, {"name": "Estaci\u00f3n Tren", "lat": 43.3528011, "lon": -8.4091132, "capacity": 15, "bikes": 6.116370808678501, "occupancy": 0.4077580539119001, "cluster": 3}, {"name": "Expocoruna", "lat": 43.3389282, "lon": -8.411651, "capacity": 19, "bikes": 6.279421433267587, "occupancy": 0.3304958649088204, "cluster": 2}, {"name": "Forum Metropolitano", "lat": 43.355798, "lon": -8.399461, "capacity": 23, "bikes": 5.780263157894737, "occupancy": 0.2513157894736842, "cluster": 2}, {"name": "Gaiteira", "lat": 43.354245, "lon": -8.396225, "capacity": 15, "bikes": 5.371052631578947, "occupancy": 0.3580701754385965, "cluster": 3}, {"name": "Hospital Abente y Lago", "lat": 43.36874508285373, "lon": -8.390026720523842, "capacity": 15, "bikes": 5.575936883629192, "occupancy": 0.37172912557527943, "cluster": 0}, {"name": "Lonzas", "lat": 43.347539, "lon": -8.414421, "capacity": 19, "bikes": 5.876315789473685, "occupancy": 0.3092797783933518, "cluster": 2}, {"name": "Los Rosales", "lat": 43.3743246, "lon": -8.4319872, "capacity": 25, "bikes": 11.369493754109138, "occupancy": 0.45477975016436556, "cluster": 1}, {"name": "Maestranza", "lat": 43.37117, "lon": -8.3909125, "capacity": 19, "bikes": 7.905325443786983, "occupancy": 0.41606976019931485, "cluster": 0}, {"name": "Marineda", "lat": 43.34621646271046, "lon": -8.427290650367745, "capacity": 23, "bikes": 10.142011834319527, "occupancy": 0.440957036274762, "cluster": 1}, {"name": "Meicende", "lat": 43.348127, "lon": -8.444042, "capacity": 23, "bikes": 7.241447368421053, "occupancy": 0.31484553775743707, "cluster": 2}, {"name": "Mercado de Monte Alto-Vila de Cambre", "lat": 43.377261, "lon": -8.403303, "capacity": 23, "bikes": 8.735526315789473, "occupancy": 0.37980549199084673, "cluster": 3}, {"name": "Millenium", "lat": 43.3768118, "lon": -8.423091, "capacity": 15, "bikes": 6.10328947368421, "occupancy": 0.40688596491228074, "cluster": 3}, {"name": "Mirador de los Castros", "lat": 43.3539722, "lon": -8.3904889, "capacity": 19, "bikes": 7.448389217619987, "occupancy": 0.392020485137894, "cluster": 3}, {"name": "Monelos, Rafael Dieste", "lat": 43.3482956, "lon": -8.4018984, "capacity": 19, "bikes": 5.9302631578947365, "occupancy": 0.31211911357340716, "cluster": 2}, {"name": "Novo Mesoiro", "lat": 43.326056379134286, "lon": -8.432357918554677, "capacity": 23, "bikes": 10.921761998685076, "occupancy": 0.4748592173341337, "cluster": 1}, {"name": "Novo Mesoiro II", "lat": 43.324886, "lon": -8.436741, "capacity": 19, "bikes": 6.911184210526316, "occupancy": 0.36374653739612184, "cluster": 2}, {"name": "Novo Mesoiro III", "lat": 43.323367, "lon": -8.443926, "capacity": 19, "bikes": 9.37236842105263, "occupancy": 0.4932825484764543, "cluster": 1}, {"name": "Obelisco", "lat": 43.3673641600456, "lon": -8.403768770639042, "capacity": 23, "bikes": 8.312294543063773, "occupancy": 0.36140411056799016, "cluster": 0}, {"name": "Orillamar", "lat": 43.375706, "lon": -8.395765, "capacity": 15, "bikes": 5.909927679158448, "occupancy": 0.3939951786105632, "cluster": 3}, {"name": "Os Castros", "lat": 43.351757, "lon": -8.389906, "capacity": 19, "bikes": 6.567478604344964, "occupancy": 0.34565676864973494, "cluster": 2}, {"name": "Os Mallos-Centro C\u00ecvico", "lat": 43.352332, "lon": -8.415516, "capacity": 23, "bikes": 6.03421052631579, "occupancy": 0.26235697940503433, "cluster": 2}, {"name": "Os Mallos-San Vicente", "lat": 43.355892, "lon": -8.408728, "capacity": 19, "bikes": 6.71231073074391, "occupancy": 0.35327951214441633, "cluster": 2}, {"name": "Palavea", "lat": 43.329469, "lon": -8.391268, "capacity": 16, "bikes": 4.636423405654175, "occupancy": 0.28977646285338593, "cluster": 2}, {"name": "Parque de Bens", "lat": 43.364053, "lon": -8.439687, "capacity": 16, "bikes": 6.021052631578947, "occupancy": 0.3763157894736842, "cluster": 2}, {"name": "Parque de Eir\u00eds", "lat": 43.34467, "lon": -8.39535, "capacity": 19, "bikes": 10.547008547008547, "occupancy": 0.5551057130004499, "cluster": 1}, {"name": "Parque de Oza", "lat": 43.351613, "lon": -8.401781, "capacity": 15, "bikes": 5.97896120973044, "occupancy": 0.39859741398202936, "cluster": 3}, {"name": "Parque de Santa Margarita", "lat": 43.3602003, "lon": -8.4150145, "capacity": 16, "bikes": 5.4605263157894735, "occupancy": 0.3412828947368421, "cluster": 2}, {"name": "Parque de Vio\u00f1o", "lat": 43.3540185, "lon": -8.4169694, "capacity": 19, "bikes": 6.163815789473684, "occupancy": 0.32441135734072024, "cluster": 2}, {"name": "Parque del Agra", "lat": 43.36514, "lon": -8.421649, "capacity": 15, "bikes": 7.085470085470085, "occupancy": 0.4723646723646724, "cluster": 3}, {"name": "Paseo de Los Puentes", "lat": 43.364594, "lon": -8.4157724, "capacity": 19, "bikes": 7.522024983563445, "occupancy": 0.3958960517664971, "cluster": 0}, {"name": "Pedralonga - Cidade das TIC", "lat": 43.33193, "lon": -8.391112, "capacity": 19, "bikes": 5.697368421052632, "occupancy": 0.29986149584487537, "cluster": 2}, {"name": "Plaza De Pontevedra", "lat": 43.3680112, "lon": -8.4066505, "capacity": 29, "bikes": 12.334648257725181, "occupancy": 0.4253326985422476, "cluster": 0}, {"name": "Plaza Indalecio Prieto", "lat": 43.378033, "lon": -8.399755, "capacity": 15, "bikes": 8.583826429980276, "occupancy": 0.5722550953320183, "cluster": 1}, {"name": "Plaza Recife", "lat": 43.364695, "lon": -8.409952, "capacity": 15, "bikes": 8.066403681788298, "occupancy": 0.5377602454525531, "cluster": 1}, {"name": "Plaza de Conchi\u00f1as", "lat": 43.3615047, "lon": -8.4199767, "capacity": 13, "bikes": 6.115055884286654, "occupancy": 0.4703889141758964, "cluster": 3}, {"name": "Plaza de Portugal", "lat": 43.3685842, "lon": -8.414535, "capacity": 20, "bikes": 8.62236842105263, "occupancy": 0.43111842105263154, "cluster": 0}, {"name": "Plaza de San Rosendo", "lat": 43.3567846, "lon": -8.4146024, "capacity": 14, "bikes": 5.548323471400394, "occupancy": 0.3963088193857424, "cluster": 3}, {"name": "Plaza de Tabacos", "lat": 43.35662860324621, "lon": -8.40148645853997, "capacity": 19, "bikes": 8.282051282051283, "occupancy": 0.4358974358974359, "cluster": 1}, {"name": "Plaza de Vigo", "lat": 43.361634, "lon": -8.407152, "capacity": 19, "bikes": 6.52465483234714, "occupancy": 0.3434028859130073, "cluster": 2}, {"name": "Praza de Ourense", "lat": 43.3651583, "lon": -8.4053212, "capacity": 15, "bikes": 6.374095989480605, "occupancy": 0.4249397326320403, "cluster": 0}, {"name": "Praza de Pontevedra II", "lat": 43.366867, "lon": -8.40984, "capacity": 18, "bikes": 9.280263157894737, "occupancy": 0.5155701754385965, "cluster": 1}, {"name": "Puerta Real", "lat": 43.3698168, "lon": -8.3957142, "capacity": 23, "bikes": 10.305719921104536, "occupancy": 0.4480747791784581, "cluster": 1}, {"name": "Puerto - Palexco", "lat": 43.3690021, "lon": -8.3988155, "capacity": 15, "bikes": 6.443786982248521, "occupancy": 0.42958579881656805, "cluster": 0}, {"name": "Ronda de Monte Alto", "lat": 43.3812, "lon": -8.405455, "capacity": 19, "bikes": 7.824342105263158, "occupancy": 0.4118074792243767, "cluster": 3}, {"name": "Rosales III - Centro de Formaci\u00f3n", "lat": 43.37361, "lon": -8.436804, "capacity": 19, "bikes": 6.451973684210526, "occupancy": 0.3395775623268698, "cluster": 2}, {"name": "Rosales-Laba\u00f1ou", "lat": 43.37409724254996, "lon": -8.42479703248882, "capacity": 15, "bikes": 4.614727153188691, "occupancy": 0.3076484768792461, "cluster": 2}, {"name": "San Andr\u00e9s-Cordeler\u00eda", "lat": 43.370182, "lon": -8.404372, "capacity": 19, "bikes": 9.154048716260698, "occupancy": 0.4817920376979315, "cluster": 0}, {"name": "San Pedro de Visma", "lat": 43.367931, "lon": -8.429594, "capacity": 19, "bikes": 10.44078947368421, "occupancy": 0.5495152354570637, "cluster": 1}, {"name": "Torre de H\u00e9rcules", "lat": 43.3833583, "lon": -8.4020407, "capacity": 15, "bikes": 5.425378040762656, "occupancy": 0.3616918693841771, "cluster": 2}, {"name": "Ventorrillo", "lat": 43.359323, "lon": -8.422561, "capacity": 19, "bikes": 8.294543063773833, "occupancy": 0.4365548980933596, "cluster": 3}, {"name": "Xux\u00e1n I-Eiris", "lat": 43.339529, "lon": -8.398775, "capacity": 19, "bikes": 5.223026315789474, "occupancy": 0.2748961218836565, "cluster": 2}, {"name": "Xux\u00e1n II -Lavedra", "lat": 43.337357, "lon": -8.402708, "capacity": 19, "bikes": 5.05, "occupancy": 0.2657894736842105, "cluster": 2}, {"name": "\u00c1gora", "lat": 43.363261912647694, "lon": -8.427038522720345, "capacity": 20, "bikes": 6.282708744247206, "occupancy": 0.3245856258002007, "cluster": 2}];
        const flows = [{"from_lat": 43.377261, "from_lon": -8.403303, "to_lat": 43.3690021, "to_lon": -8.3988155, "strength": 0.19268900432358063}, {"from_lat": 43.377261, "from_lon": -8.403303, "to_lat": 43.3673641600456, "to_lon": -8.403768770639042, "strength": 0.17855276390587596}, {"from_lat": 43.354245, "from_lon": -8.396225, "to_lat": 43.3673641600456, "to_lon": -8.403768770639042, "strength": 0.1738834447262909}, {"from_lat": 43.377261, "from_lon": -8.403303, "to_lat": 43.370182, "to_lon": -8.404372, "strength": 0.16351750814151156}, {"from_lat": 43.35436551376532, "from_lon": -8.422193301049806, "to_lat": 43.3743246, "to_lon": -8.4319872, "strength": 0.1609159953147303}, {"from_lat": 43.35436551376532, "from_lon": -8.422193301049806, "to_lat": 43.3812, "to_lon": -8.405455, "strength": 0.15865417372806448}, {"from_lat": 43.354245, "from_lon": -8.396225, "to_lat": 43.3690021, "to_lon": -8.3988155, "strength": 0.15472690312705695}];
        const clusterColors = ["#06B6D4", "#D946EF", "#FACC15", "#8B5CF6"];
        
        const map = L.map('map', { zoomControl:false, attributionControl:false }).setView([43.35807862922293, -8.410188153694527], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {maxZoom:19}).addTo(map);

        stations.forEach(s => {
            let fill = '#F59E0B';
            if (s.occupancy < 0.3) fill = '#EF4444';
            if (s.occupancy > 0.6) fill = '#10B981';
            
            L.circleMarker([s.lat, s.lon], {
                radius: 6,
                fillColor: fill,
                color: clusterColors[s.cluster],
                weight: 2,
                opacity: 1,
                fillOpacity: 0.85
            }).bindPopup(`
                <div style="font-family:Inter; padding:5px;">
                    <b>${s.name}</b><br>
                    <span style="color:${clusterColors[s.cluster]}">● Cluster ${s.cluster + 1}</span><br>
                    Ocupación: ${(s.occupancy*100).toFixed(0)}%
                </div>
            `).addTo(map);
        });
        
        flows.forEach(f => {
            L.polyline([[f.from_lat, f.from_lon], [f.to_lat, f.to_lon]], {
                color: '#64748B', weight: f.strength * 4, opacity: 0.3, interactive: false
            }).addTo(map);
        });
    </script>
</body>
</html>